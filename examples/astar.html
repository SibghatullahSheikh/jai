<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>jAI - Javascript artificial intelligence library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      #astar div {
        width:20px;
        height:20px;
        float: left;
        border-bottom:1px solid black;
        border-right:1px solid black;
        background: #f5f5f5;
      }
      #astar div.limit_top {
        border-top:1px solid black;
      }
      #astar div.limit_left {
        border-left:1px solid black;
      }
      #astar h2 {
        text-align:center;
        margin-top: 30px;
        font-size: 25px;
        color: white;
      }
      #find_way {
        visibility: hidden;
        display: none;
      }
    </style>
    <link href="../css/bootstrap-responsive.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../ico/apple-touch-icon-57-precomposed.png">
    <link rel="shortcut icon" href="../ico/favicon.png">
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="../">jAI</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="../">Home</a></li>
              <li><a href="../docs/">Documentation</a></li>
              <li><a href="//github.com/elfathorn">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span2">
          <div class="well sidebar-nav">
            <form class="offset1" id="create_map">
              <fieldset>
                <legend>Create your map</legend>
                <label>Width</label>
                <input type="number" placeholder="width" name="width" id="width" />
                <label>Height</label>
                <input type="number" placeholder="height" name="height" id="height" />
                <button type="submit" class="btn">Submit</button>
              </fieldset>
            </form>
            <form class="offset1" id="find_way">
              <fieldset>
                <legend>Find your way</legend>
                <label>Start</label>
                <input type="number" placeholder="start x" name="start_x" id="start_x" />
                <input type="number" placeholder="start y" name="start_y" id="start_y" />
                <label>End</label>
                <input type="number" placeholder="end x" name="end_x" id="end_x" />
                <input type="number" placeholder="end y" name="end_y" id="end_y" />
                <button type="submit" class="btn">Submit</button>
              </fieldset>
            </form>
          </div><!--/.well -->
        </div><!--/span-->
        <div class="span10" id="astar">
        </div><!--/span-->
      </div><!--/row-->

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jai.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {
      var w = 0;
      var h = 0;

      var map = null;
      var astar = null;

      $('#create_map').on('submit', function() {
        w = $("#width").val();
        h = $("#height").val();

        if(w <= 0 || h <= 0) 
          return false;

        map = new JAI.Map(0, w-1, 0, h-1);

        $("#astar").html('');
        for (var y = 0; y < h; y++) {
          for (var x = 0; x < w; x++) {
            var class_limit = '';
            if (y == 0)  {
              class_limit = class_limit + 'limit_top';
            };
            if (x == 0) {
              class_limit = class_limit + (class_limit == '' ? 'limit_left' : ' limit_left');
            };

            var append = (class_limit == '' ? '' : 'class="' + class_limit + '" ');

            $("#astar").append('<div ' + append + 'id="div_x'+x+'y'+y+'"></div>');
            
            $("#div_x"+x+"y"+y).click(function() {
              var array = $(this).attr('id').split('y');
              var x = array[0].split('div_x')[1];
              var y = array[1];
              map.find(x, y).setBlock();
              $(this).css('background', 'black');
            });
          };
          $("#astar").append('<div style="clear:both;float:none;width:0px;border:0;height:0;"></div>');
        };

        $('#find_way').css('display', 'block');
        $('#find_way').css('visibility', 'visible');

        return false;
      });

      $('#find_way').on('submit', function() {
        if(w <= 0 || h <= 0) 
          return false;

        start_x = $("#start_x").val();
        start_y = $("#start_y").val();
        end_x = $("#end_x").val();
        end_y = $("#end_y").val();

        if (start_x < 0 || start_y < 0 || end_x < 0 || end_y < 0 || start_x >= w || start_y >= h || end_x >= w || end_y >= h) {
          alert('bad start and/or end points');
          return false;
        };

        if (start_x == end_x && start_y == end_y ) {
          alert('same start and end points');
          return false;
        };

        astar = new JAI.Astar(map);
        astar.init(start_x, start_y, end_x, end_y);

        $('#div_x' + astar.start.x + 'y' + astar.start.y).html('<h2>START</h2>');
        $('#div_x' + astar.end.x + 'y' + astar.end.y).html('<h2>END<h2>');

        $('#div_x' + astar.start.x + 'y' + astar.start.y).css('background', '#5eb95e');
        $('#div_x' + astar.end.x + 'y' + astar.end.y).css('background', '#5eb95e');

        if (astar.run()) {
          alert('path finded!');
          var index = astar.close_list.find(astar.end.x, astar.end.y);
          var current = astar.close_list.content[index];

          $('#div_x' + current[0] + 'y' + current[1]).css('background', '#5eb95e');

          var path = current[0]+','+current[1]+':::';
          var prec_key = current[2].parent_key;
          $('#div_' + prec_key.replace(":", "")).css('background', '#5eb95e');
          var infos = prec_key.split(":y");
          var prec_x = infos[0].split("x")[1];
          var prec_y = infos[1];
          path += prec_x+','+prec_y+':::';

          while (!(prec_x == astar.start.x && prec_y == astar.start.y)){
              var index_prec = astar.close_list.find(prec_x, prec_y);
              var precedent = astar.close_list.content[index_prec][2];

              prec_key = precedent.parent_key;
              infos = prec_key.split(":y");
              prec_x = infos[0].split("x")[1];
              prec_y = infos[1];
              path += prec_x+','+prec_y+':::';
              $('#div_' + prec_key.replace(":", "")).css('background', '#5eb95e');
          }
        } else {
          alert('no solution');
        };

        return false;
      });

        

          
    });
    </script>

  </body>
</html>
